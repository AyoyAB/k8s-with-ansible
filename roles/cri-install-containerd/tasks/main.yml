- include_tasks: setup-Debian.yml
  when:
    - ansible_os_family == 'Debian'
    - ansible_distribution != 'Ubuntu'

- include_tasks: setup-Ubuntu.yml
  when:
    - ansible_os_family == 'Debian'
    - ansible_distribution == 'Ubuntu'

- name: Configure kubernetes cri startup
  template:
    src: ./templates/99-kubernetes-cri.conf
    dest: /etc/sysctl.d/99-kubernetes-cri.conf
  notify: Reboot

- name: Create containerd config directory
  become: yes
  file:
    path: /etc/containerd
    state: directory
  notify: Reboot

- name: Configure containerd
  template:
    src: ./templates/config.toml
    dest: /etc/containerd/config.toml
  notify: Reboot

- name: Flush handlers
  meta: flush_handlers
